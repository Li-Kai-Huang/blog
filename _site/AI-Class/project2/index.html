<!DOCTYPE html>
<html lang="zh-TW">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/blog/feed.xml" title="LI KAI 部落格" />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>AI 監視錄影系統 | LI KAI 部落格</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="AI 監視錄影系統" />
<meta name="author" content="Li Kai_Huang" />
<meta property="og:locale" content="zh_TW" />
<meta name="description" content="這篇文章會講解我邊緣運算的第二個專案 AI 監視錄影系統" />
<meta property="og:description" content="這篇文章會講解我邊緣運算的第二個專案 AI 監視錄影系統" />
<link rel="canonical" href="http://localhost:4000/blog/AI-Class/project2/" />
<meta property="og:url" content="http://localhost:4000/blog/AI-Class/project2/" />
<meta property="og:site_name" content="LI KAI 部落格" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-06-07T15:40:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AI 監視錄影系統" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Li Kai_Huang"},"dateModified":"2025-06-07T15:40:00+08:00","datePublished":"2025-06-07T15:40:00+08:00","description":"這篇文章會講解我邊緣運算的第二個專案 AI 監視錄影系統","headline":"AI 監視錄影系統","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/AI-Class/project2/"},"url":"http://localhost:4000/blog/AI-Class/project2/"}</script>
<!-- End Jekyll SEO tag -->

  
  <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/pure-min.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/grids-responsive-min.css">
  <link rel="stylesheet" href="/blog/assets/css/open-color.css">
  <link rel="stylesheet" href="/blog/assets/css/hydure.css">

  <script async src="https://use.fontawesome.com/releases/v5.12.0/js/all.js"></script>

  

</head>


  <body>
    <div id="layout" class="pure-g">
      
      
      <div class="sidebar pure-u-1 pure-u-md-1-4" style="background-image: url(https://cdn.jsdelivr.net/gh/zivong/jekyll-theme-hydure@v2.0.0/cover.jpg);">
        <div class="sidebar-shield">
          <header class="header">
  <a class="brand-title" href="/blog/">LI KAI 部落格</a>
  <p class="brand-tagline">寫下我的生活與技術分享</p>

  
    <nav class="nav pure-menu">
      <ul class="pure-menu-list">
      
        <li class="nav-item pure-menu-item">
          <a href="/blog/" class="pure-menu-link ">
            Home
          </a>
        </li>
      
        <li class="nav-item pure-menu-item">
          <a href="/blog/about/" class="pure-menu-link ">
            About
          </a>
        </li>
      
        <li class="nav-item pure-menu-item">
          <a href="/blog/tags/" class="pure-menu-link ">
            Tags
          </a>
        </li>
      
        <li class="nav-item pure-menu-item">
          <a href="/blog/categories/" class="pure-menu-link ">
            Categories
          </a>
        </li>
      
        <li class="nav-item pure-menu-item">
          <a href="https://github.com/Li-Kai-Huang" class="pure-menu-link ">
            GitHub
          </a>
        </li>
      
      </ul>
    </nav>
  

  
    <div class="social pure-menu pure-menu-horizontal">
      <ul class="social-list pure-menu-list">
        
          <li class="social-item pure-menu-item">
            <a class="pure-menu-link pure-button" href="mailto:moray.huang@gmail.com" target="_blank">
              <i class="fas fa-envelope" title="Email"></i>
            </a>
          </li>
        
          <li class="social-item pure-menu-item">
            <a class="pure-menu-link pure-button" href="https://www.facebook.com/moray.huang" target="_blank">
              <i class="fab fa-facebook" title="FaceBook"></i>
            </a>
          </li>
        
          <li class="social-item pure-menu-item">
            <a class="pure-menu-link pure-button" href="https://www.instagram.com/likai._.huang" target="_blank">
              <i class="fab fa-Instagram" title="Instagram"></i>
            </a>
          </li>
        
          <li class="social-item pure-menu-item">
            <a class="pure-menu-link pure-button" href="https://github.com/Li-Kai-Huang" target="_blank">
              <i class="fab fa-github" title="GitHub"></i>
            </a>
          </li>
        
      </ul>
    </div>
  
</header>

        </div>
      </div>
      <div class="content pure-u-1 pure-u-md-3-4">
        <div class="main">
          <article class="post">
  
    <div class="post-meta">
      <ul class="post-categories"><li>
            <span class="post-category">1131邊緣運算課</span></li></ul>
    </div>
  
  <h1 class="post-title">AI 監視錄影系統</h1>
  <div class="post-meta">
    <time datetime="2025-06-07T15:40:00+08:00" itemprop="datePublished">
      07 Jun 2025
    </time></div>
  
  <h1 id="ai-監視錄影系統">AI 監視錄影系統</h1>

<p>本報告旨在介紹一個基於邊緣 AI 技術的輔助回收系統。該系統利用 Realtek AMB82_mini 微控制器作為核心處理單元，整合影像辨識與語音互動功能，旨在實現對回收物品的自動識別與語音指引，從而提升回收效率與正確性。</p>

<ul>
  <li><a href="#ai-監視錄影系統">AI 監視錄影系統</a>
    <ul>
      <li><a href="#功能">功能</a></li>
      <li><a href="#genai程式碼設計流程">GenAI程式碼設計流程</a></li>
      <li><a href="#程式碼產生提示">程式碼產生提示</a></li>
      <li><a href="#程式碼">程式碼</a></li>
      <li><a href="#實作成果">實作成果</a>
        <ul>
          <li><a href="#demo-數據">Demo 數據</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="功能">功能</h2>

<p>1) 每分鐘捕捉影像並傳送至 Gemini Vision (1 分鐘拍攝)</p>

<p>2) 如果回覆文字沒有變化，則不儲存 jpg 和文字如果回應的文字與先前的場景不同，則儲存 jpg 和文字(使用日期+時間作為檔案名稱）</p>

<h2 id="genai程式碼設計流程">GenAI程式碼設計流程</h2>

<pre><code class="language-mermaid">graph TD
    A[開始] --&gt; B[系統初始化];
    B --&gt; C{啟動定時器 - 每分鐘觸發};
    C --&gt; D[定時器觸發];
    D --&gt; E[捕捉影像];
    E --&gt; F[影像數據預處理/壓縮];
    F --&gt; G[發送影像至 Google Gemini Vision];
    G --&gt; H{等待 Gemini 回應};
    H -- 成功回應 --&gt; I[接收 Gemini 回應 - 文字描述];
    I -- 失敗回應 --&gt; P[處理 Gemini 錯誤/重試];
    P --&gt; C;

    I --&gt; J{比較當前文字與先前文字};
    J -- 文字無變化 --&gt; K[不儲存];
    K --&gt; C;

    J -- 文字有變化 --&gt; L[儲存 JPG 影像];
    L --&gt; M[儲存文字描述];
    M --&gt; N[使用日期+時間作為檔名];
    N --&gt; O[完成儲存];
    O --&gt; C;
</code></pre>

<h2 id="程式碼產生提示">程式碼產生提示</h2>
<p><strong>給AI的提示詞</strong>：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>我給你兩份範例代碼請幫我結合 並符合以下要求

1）每分鐘捕捉影像並發送給Gemini Vision（1分鐘拍攝）

2）如果回覆文字沒有變化，則不儲存 jpg 和文字

如果回應的文字與先前的場景不同，則儲存 jpg 和文字 

（使用日期+時間作為檔案名稱）

1.  GenAIVision.ino

2.  CaptureJPG_SDcard.ino
</code></pre></div></div>

<h2 id="程式碼">程式碼</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"VideoStream.h"</span><span class="cp">
#include</span> <span class="cpf">"AmebaFatFS.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;WiFi.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"GenAI.h"</span><span class="cp">
#include</span> <span class="cpf">"rtc.h"</span><span class="c1">    // Correct library for AmebaPro2 RTC</span><span class="cp">
#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="c1">   // Still needed for struct tm and localtime()</span><span class="cp">
</span>
<span class="c1">// --- Configuration Defines ---</span>
<span class="cp">#define CHANNEL 0
#define CAPTURE_INTERVAL_MS 60000 // 1 minute in milliseconds
</span>
<span class="c1">// --- API Keys and Wi-Fi Credentials (from your provided code) ---</span>
<span class="n">String</span> <span class="n">Gemini_key</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span> <span class="c1">// Your Gemini API key</span>
<span class="kt">char</span> <span class="n">wifi_ssid</span><span class="p">[]</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span><span class="c1">// Your Wi-Fi network SSID</span>
<span class="kt">char</span> <span class="n">wifi_pass</span><span class="p">[]</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span><span class="c1">// Your Wi-Fi network password</span>

<span class="c1">// --- RTC Initial Time Settings ---</span>
<span class="c1">// These values will be used to set the RTC initially when the board powers on.</span>
<span class="c1">// Adjust these to your current date and time for accurate timestamps.</span>
<span class="cp">#define INITIAL_YEAR  2024
#define INITIAL_MONTH 5
#define INITIAL_DAY   22
#define INITIAL_HOUR  20
#define INITIAL_MIN   40
#define INITIAL_SEC   0
</span>
<span class="c1">// --- Global Objects and Variables ---</span>
<span class="n">WiFiSSLClient</span> <span class="n">client</span><span class="p">;</span>
<span class="n">GenAI</span> <span class="n">llm</span><span class="p">;</span>

<span class="c1">// Camera settings: 768x768 resolution, optimized for vision models</span>
<span class="n">VideoSetting</span> <span class="nf">config</span><span class="p">(</span><span class="mi">768</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="n">CAM_FPS</span><span class="p">,</span> <span class="n">VIDEO_JPEG</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="kt">uint32_t</span> <span class="n">img_addr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Pointer to the image data in memory</span>
<span class="kt">uint32_t</span> <span class="n">img_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// Length of the image data</span>

<span class="n">AmebaFatFS</span> <span class="n">fs</span><span class="p">;</span> <span class="c1">// File system object for SD card operations</span>
<span class="n">File</span> <span class="n">file</span><span class="p">;</span>     <span class="c1">// File object for reading/writing to SD card</span>

<span class="n">String</span> <span class="n">prompt_msg</span> <span class="o">=</span> <span class="s">"Please describe the image, and if there is a text, please summarize the content"</span><span class="p">;</span>
<span class="n">String</span> <span class="n">previous_gemini_response</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span> <span class="c1">// Stores the last Gemini response for comparison</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_capture_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// Tracks the time of the last image capture</span>

<span class="c1">// --- Function to initialize Wi-Fi connection ---</span>
<span class="kt">void</span> <span class="nf">initWiFi</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connecting to WiFi..."</span><span class="p">);</span>
  <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">wifi_ssid</span><span class="p">,</span> <span class="n">wifi_pass</span><span class="p">);</span> <span class="c1">// Start Wi-Fi connection</span>

  <span class="kt">uint32_t</span> <span class="n">StartTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span> <span class="c1">// Wait a bit before checking again</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">StartTime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">15000</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Timeout after 15 seconds</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">WiFi connection timed out. Please check credentials and try again."</span><span class="p">);</span>
      <span class="c1">// In a real application, you might want to restart or go into a low-power mode here.</span>
      <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span> <span class="c1">// Halt execution if WiFi fails after timeout</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">WiFi connected!"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"STA IP address: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">// --- Setup Function: Runs once at startup ---</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// Initialize serial communication for debugging</span>

  <span class="c1">// Initialize Wi-Fi</span>
  <span class="n">initWiFi</span><span class="p">();</span>

  <span class="c1">// Initialize RTC and set initial time</span>
  <span class="n">rtc</span><span class="p">.</span><span class="n">Init</span><span class="p">();</span> <span class="c1">// Initialize the RTC module</span>
  <span class="c1">// Set the initial epoch time for the RTC</span>
  <span class="kt">long</span> <span class="kt">long</span> <span class="n">epochTime</span> <span class="o">=</span> <span class="n">rtc</span><span class="p">.</span><span class="n">SetEpoch</span><span class="p">(</span><span class="n">INITIAL_YEAR</span><span class="p">,</span> <span class="n">INITIAL_MONTH</span><span class="p">,</span> <span class="n">INITIAL_DAY</span><span class="p">,</span> <span class="n">INITIAL_HOUR</span><span class="p">,</span> <span class="n">INITIAL_MIN</span><span class="p">,</span> <span class="n">INITIAL_SEC</span><span class="p">);</span>
  <span class="n">rtc</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">epochTime</span><span class="p">);</span> <span class="c1">// Write the set epoch time to the RTC hardware</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"RTC initialized to: "</span><span class="p">);</span>
  <span class="c1">// Print current time from RTC for verification</span>
  <span class="kt">time_t</span> <span class="n">current_rtc_time</span> <span class="o">=</span> <span class="n">rtc</span><span class="p">.</span><span class="n">Read</span><span class="p">();</span> <span class="c1">// Read current time from RTC</span>
  <span class="k">struct</span> <span class="n">tm</span> <span class="o">*</span> <span class="n">timeinfo</span> <span class="o">=</span> <span class="n">localtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">current_rtc_time</span><span class="p">);</span> <span class="c1">// Convert to local time structure</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">asctime</span><span class="p">(</span><span class="n">timeinfo</span><span class="p">));</span> <span class="c1">// Print formatted time</span>

  <span class="c1">// Configure and initialize the camera</span>
  <span class="n">config</span><span class="p">.</span><span class="n">setRotation</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// Set camera rotation if needed (0 for no rotation)</span>
  <span class="n">Camera</span><span class="p">.</span><span class="n">configVideoChannel</span><span class="p">(</span><span class="n">CHANNEL</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span>
  <span class="n">Camera</span><span class="p">.</span><span class="n">videoInit</span><span class="p">();</span>
  <span class="n">Camera</span><span class="p">.</span><span class="n">channelBegin</span><span class="p">(</span><span class="n">CHANNEL</span><span class="p">);</span>
  <span class="n">Camera</span><span class="p">.</span><span class="n">printInfo</span><span class="p">();</span> <span class="c1">// Print camera information to serial</span>

  <span class="c1">// Initialize SD card file system</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fs</span><span class="p">.</span><span class="n">begin</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Failed to initialize SD card! Please check connection and format."</span><span class="p">);</span>
    <span class="c1">// Handle SD card initialization failure (e.g., halt, retry)</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">);</span> <span class="c1">// Halt execution if SD card fails</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"SD card initialized successfully."</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"SD card root path: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">fs</span><span class="p">.</span><span class="n">getRootPath</span><span class="p">());</span> <span class="c1">// Print the actual root path for debugging</span>

  <span class="c1">// Set initial capture time to ensure an immediate capture on startup</span>
  <span class="c1">// Subtracting CAPTURE_INTERVAL_MS makes the first capture happen immediately in loop()</span>
  <span class="n">last_capture_time</span> <span class="o">=</span> <span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">CAPTURE_INTERVAL_MS</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// --- Loop Function: Runs repeatedly ---</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">current_time_millis</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span> <span class="c1">// Get current uptime in milliseconds</span>

  <span class="c1">// Check if it's time to capture a new image (every minute)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">current_time_millis</span> <span class="o">-</span> <span class="n">last_capture_time</span> <span class="o">&gt;=</span> <span class="n">CAPTURE_INTERVAL_MS</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">last_capture_time</span> <span class="o">=</span> <span class="n">current_time_millis</span><span class="p">;</span> <span class="c1">// Update the last capture time to now</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">--- Capturing Image ---"</span><span class="p">);</span>
    <span class="n">Camera</span><span class="p">.</span><span class="n">getImage</span><span class="p">(</span><span class="n">CHANNEL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">img_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">img_len</span><span class="p">);</span> <span class="c1">// Capture image data into memory</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">img_len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Failed to capture image (length is 0). Skipping Gemini Vision."</span><span class="p">);</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// Wait a bit before trying again to avoid rapid failures</span>
      <span class="k">return</span><span class="p">;</span>      <span class="c1">// Skip the rest of the loop for this iteration</span>
    <span class="p">}</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Sending image to Gemini Vision..."</span><span class="p">);</span>
    <span class="c1">// Call Gemini Vision API with the captured image data and prompt</span>
    <span class="n">String</span> <span class="n">current_gemini_response</span> <span class="o">=</span> <span class="n">llm</span><span class="p">.</span><span class="n">geminivision</span><span class="p">(</span><span class="n">Gemini_key</span><span class="p">,</span> <span class="s">"gemini-2.0-flash"</span><span class="p">,</span> <span class="n">prompt_msg</span><span class="p">,</span> <span class="n">img_addr</span><span class="p">,</span> <span class="n">img_len</span><span class="p">,</span> <span class="n">client</span><span class="p">);</span>
    
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Gemini Response: "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">current_gemini_response</span><span class="p">);</span>

    <span class="c1">// Compare the current Gemini response with the previous one</span>
    <span class="c1">// Also ensure the current response is not empty before storing</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">current_gemini_response</span> <span class="o">!=</span> <span class="n">previous_gemini_response</span> <span class="o">&amp;&amp;</span> <span class="n">current_gemini_response</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Gemini response is different from previous or not empty. Storing image and text."</span><span class="p">);</span>

      <span class="c1">// Get current date and time from RTC for filename</span>
      <span class="kt">time_t</span> <span class="n">t</span> <span class="o">=</span> <span class="n">rtc</span><span class="p">.</span><span class="n">Read</span><span class="p">();</span> <span class="c1">// Get current epoch time (Unix timestamp) from the RTC</span>
      <span class="k">struct</span> <span class="n">tm</span> <span class="o">*</span> <span class="n">timeinfo</span> <span class="o">=</span> <span class="n">localtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">);</span> <span class="c1">// Convert epoch time to a broken-down time structure</span>

      <span class="c1">// Increased buffer size to 64 to prevent sprintf overflow warnings</span>
      <span class="kt">char</span> <span class="n">filename_date_time</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span> <span class="c1">// Buffer for just the date_time part of the filename</span>
      <span class="kt">char</span> <span class="n">full_filename_buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span> <span class="c1">// Larger buffer for the full path</span>

      <span class="c1">// Create the date_time part of the filename: YYYYMMDD_HHMMSS</span>
      <span class="n">sprintf</span><span class="p">(</span><span class="n">filename_date_time</span><span class="p">,</span> <span class="s">"%04d%02d%02d_%02d%02d%02d"</span><span class="p">,</span> 
              <span class="n">timeinfo</span><span class="o">-&gt;</span><span class="n">tm_year</span> <span class="o">+</span> <span class="mi">1900</span><span class="p">,</span>  <span class="c1">// Add 1900 to get full year</span>
              <span class="n">timeinfo</span><span class="o">-&gt;</span><span class="n">tm_mon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>      <span class="c1">// Add 1 to get month (1-12)</span>
              <span class="n">timeinfo</span><span class="o">-&gt;</span><span class="n">tm_mday</span><span class="p">,</span>         <span class="c1">// Day of the month</span>
              <span class="n">timeinfo</span><span class="o">-&gt;</span><span class="n">tm_hour</span><span class="p">,</span>         <span class="c1">// Hour (0-23)</span>
              <span class="n">timeinfo</span><span class="o">-&gt;</span><span class="n">tm_min</span><span class="p">,</span>          <span class="c1">// Minute (0-59)</span>
              <span class="n">timeinfo</span><span class="o">-&gt;</span><span class="n">tm_sec</span><span class="p">);</span>         <span class="c1">// Second (0-59)</span>

      <span class="c1">// Get the root path from the SD card file system</span>
      <span class="n">String</span> <span class="n">rootPath</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">getRootPath</span><span class="p">();</span>
      <span class="c1">// Ensure rootPath does not end with a slash if it's not empty, to avoid double slashes</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">rootPath</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">rootPath</span><span class="p">.</span><span class="n">endsWith</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">rootPath</span> <span class="o">!=</span> <span class="s">"/"</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">rootPath</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rootPath</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// Construct the full image filename: &lt;rootPath&gt;/YYYYMMDD_HHMMSS.jpg</span>
      <span class="n">sprintf</span><span class="p">(</span><span class="n">full_filename_buffer</span><span class="p">,</span> <span class="s">"%s/%s.jpg"</span><span class="p">,</span> <span class="n">rootPath</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">filename_date_time</span><span class="p">);</span>
      <span class="n">String</span> <span class="n">image_filename</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">full_filename_buffer</span><span class="p">);</span>

      <span class="c1">// Construct the full text filename: &lt;rootPath&gt;/YYYYMMDD_HHMMSS.txt</span>
      <span class="n">sprintf</span><span class="p">(</span><span class="n">full_filename_buffer</span><span class="p">,</span> <span class="s">"%s/%s.txt"</span><span class="p">,</span> <span class="n">rootPath</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">filename_date_time</span><span class="p">);</span>
      <span class="n">String</span> <span class="n">text_filename</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">full_filename_buffer</span><span class="p">);</span>

      <span class="c1">// --- Store Image to SD Card ---</span>
      <span class="c1">// Open file in write mode using FA_WRITE (correct for AmebaFatFS)</span>
      <span class="n">file</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_filename</span><span class="p">,</span> <span class="n">FA_WRITE</span><span class="p">);</span> 
      <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">file</span><span class="p">.</span><span class="n">write</span><span class="p">((</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span><span class="n">img_addr</span><span class="p">,</span> <span class="n">img_len</span><span class="p">);</span> <span class="c1">// Write image data from memory to SD card</span>
        <span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span> <span class="c1">// Close the file to save changes</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Image stored as: "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">image_filename</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Error: Could not open image file for writing: "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">image_filename</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// --- Store Text to SD Card ---</span>
      <span class="c1">// Open file in write mode using FA_WRITE</span>
      <span class="n">file</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">text_filename</span><span class="p">,</span> <span class="n">FA_WRITE</span><span class="p">);</span> 
      <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">file</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">current_gemini_response</span><span class="p">);</span> <span class="c1">// Write the Gemini response text to SD card</span>
        <span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span> <span class="c1">// Close the file to save changes</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Text stored as: "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">text_filename</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Error: Could not open text file for writing: "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">text_filename</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="c1">// Update the previous response for the next comparison</span>
      <span class="n">previous_gemini_response</span> <span class="o">=</span> <span class="n">current_gemini_response</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Gemini response is the same as previous or empty. Not storing image or text."</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// Small delay to prevent busy-waiting and allow other tasks to run</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="實作成果">實作成果</h2>

<h3 id="demo-數據">Demo 數據</h3>

<p><img src="/assets/photo/Edge-Ai-Class-Project/AI監視器/image.png" alt="imag" /></p>

<p>以下是檔案的詳細資料</p>

<p><img src="/assets/photo/Edge-Ai-Class-Project/AI監視器/20250522_210653.jpg" alt="imag" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>20250522_210653.txt

The image shows a computer screen displaying a webpage for Anaconda, a Python distribution. The webpage is primarily in Chinese, with some English words such as "Anaconda" and "Install Anaconda on Ubuntu".  The page seems to be showing instructions or information regarding installation and other details related to Anaconda. The computer is in a computer lab setting, with other computers visible in the background.  Several people are partially visible in the background, seemingly working on other computers.
</code></pre></div></div>

<p><img src="/assets/photo/Edge-Ai-Class-Project/AI監視器/20250522_210755.jpg" alt="imag" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>20250522_210755.txt

Here's a description of the image:
The image shows a computer lab or internet cafe setting. The focus is on a  large computer monitor in the foreground, displaying a webpage that is   partially visible and blurry.  The webpage seems to contain text and possibly     an image or advertisement.  Surrounding this main monitor are several other     computer monitors, arranged in rows. The monitors are relatively small compared     to the one in the foreground, and their screens are partially obscured. The     room itself appears to be a typical office or classroom setting, with a white   ceiling, fluorescent lighting, and what look like cubicle partitions partially    visible behind the computers.  A keyboard is visible in the bottom-left corner,    partially obscuring the edge of a laptop.  The overall lighting is bright but  somewhat washed out, likely due to the fluorescent lights.
The text on the main monitor is unclear and unreadable due to blurriness and    distance.  Therefore, no summary of the webpage's content can be provided.
</code></pre></div></div>

<p><img src="/assets/photo/Edge-Ai-Class-Project/AI監視器/20250522_210851.jpg" alt="imag" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>20250522_210851.jpg

The image shows a section of a white ceiling.  There is a long fluorescent light fixture mounted on the ceiling, as well as what appears to be a portion of an air conditioning vent or exhaust fan in the upper right corner. There is no text visible in the image.
</code></pre></div></div>



  
    <div class="post-meta">
      <i class="post-tags-icon fas fa-tag"></i>
      <ul class="post-tags"><li>
            <span class="post-tag">入門</span></li><li>
            <span class="post-tag">學習</span></li><li>
            <span class="post-tag">blog</span></li></ul>
    </div>
  

  
</article>

        </div>
        <footer class="footer pure-g">
  <div class="pure-u-1 pure-u-md-1-2">
    <small>
      &copy;&nbsp;<time datetime="2025-06-14T23:16:14+08:00">2025</time>&nbsp;<a href="" target="_blank">Li Kai_Huang</a>. All right reserved.
    </small>
  </div>

  <div class="pure-u-1 pure-u-md-1-2">
    <small>
      Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> & <a href="https://github.com/zivong/jekyll-theme-hydure" target="_blank">Hydure</a>
    </small>
  </div>
</footer>

      </div>
    </div>

    

    
  </body>
</html>
